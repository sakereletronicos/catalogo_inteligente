<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Catálogo Dinâmico</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f9f9f9;margin:0;padding:0}
    header{background:#333;color:#fff;padding:1rem;text-align:center}
    .filtros{display:flex;justify-content:center;gap:1rem;padding:1rem;background:#fff}
    .filtros input,.filtros select{padding:0.5rem;font-size:1rem}
    .catalogo{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;padding:2rem}
    .produto{background:#fff;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);transition:transform .2s}
    .produto:hover{transform:scale(1.02)}
    .produto a{display:block;text-decoration:none;color:inherit;padding:1rem}
    .produto img{max-width:100%;border-radius:5px}
    .produto h2{margin:0.5rem 0;font-size:1.2rem}
    .produto .preco{color:#009688;font-weight:bold}
    footer{text-align:center;padding:1rem;background:#333;color:#fff;margin-top:2rem}
  </style>
</head>
<body>

<header><h1>Catálogo Dinâmico</h1></header>

<section class="filtros">
  <input id="busca" type="text" placeholder="Buscar por nome...">
  <select id="categoria">
    <option value="">Todas categorias</option>
  </select>
  <select id="preco">
    <option value="">Todos os preços</option>
    <option value="0-100">Até R$100</option>
    <option value="100-200">R$100 a R$200</option>
    <option value="200-9999">Acima de R$200</option>
  </select>
</section>

<section id="catalogo" class="catalogo"></section>
<footer>&copy; 2025 Catálogo Dinâmico</footer>

<script>

	const spreadsheetId = '1yJqq-aL5oUnBtxb93bJy2JwLx3ccwuaoQz_UbHAI5_s';
	const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:json`;


  let produtos = [];

  fetch(url)
    .then(res => res.text())
    .then(txt => {
      const json = JSON.parse(txt.match(/(?<=\().*(?=\);)/s)[0]);
      const cols = json.table.cols.map(c => c.label);
      produtos = json.table.rows.map(r => {
        return r.c.reduce((o, cell, i) => {
          o[cols[i]] = cell?.v || '';
          return o;
        }, {});
      });
      populaCategorias();
      renderProdutos(produtos);
    });

  const catalogoEl = document.getElementById("catalogo");
  const buscaEl = document.getElementById("busca");
  const categoriaEl = document.getElementById("categoria");
  const precoEl = document.getElementById("preco");

  function populaCategorias(){
    const cats = [...new Set(produtos.map(p=>p.categoria))];
    cats.forEach(cat =>{
      const op = document.createElement('option');
      op.value = op.textContent = cat;
      categoriaEl.append(op);
    });
  }

  function renderProdutos(lista){
    catalogoEl.innerHTML = lista.length
      ? lista.map(p => `
        <div class="produto">
          <a href="${p.link}" target="_blank">
            <img src="${p.imagem}" alt="${p.nome}">
            <h2>${p.nome}</h2>
            <p>${p.categoria}</p>
            <div class="preco">R$ ${Number(p.preco).toFixed(2)}</div>
          </a>
        </div>
      `).join('')
      : '<p>Nenhum produto encontrado.</p>';
  }

  function filtrar(){
    const b = buscaEl.value.toLowerCase();
    const c = categoriaEl.value;
    const pr = precoEl.value;
    let f = produtos.filter(p=>
      p.nome.toLowerCase().includes(b) &&
      (c===''||p.categoria===c)
    );
    if(pr){
      const [min,max] = pr.split('-').map(Number);
      f = f.filter(p=>Number(p.preco)>=min && Number(p.preco)<=max);
    }
    renderProdutos(f);
  }

  buscaEl.addEventListener('input', filtrar);
  categoriaEl.addEventListener('change', filtrar);
  precoEl.addEventListener('change', filtrar);
</script>

</body>
</html>
